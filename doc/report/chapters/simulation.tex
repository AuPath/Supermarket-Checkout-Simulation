\chapter{Simulazione e analisi dei risultati}
\label{chapter:simulation}

In questo capitolo vedremo i risultati delle simulazioni eseguite sul nostro modello. Introdurremo due misure che ci aiuteranno a disegnare dei grafici per mettere a confronto simulazioni fatte con strategie di scelta della coda diverse e anche con parametri diversi.

\vspace*{1\baselineskip}

\todo{per ognuna di queste simulazioni fare i grafici: grafico fondamentale (flusso asse y, densità asse x), tempo medio d'attesa dei clienti (fare grafico con media e deviazione standard, i dati sono nel datacollector), grafico KDE (Kernel density estimates - ovvero densità sull'asse y e waiting time sull'asse x), grafico con tempo sull'asse x e sull'asse y probabilità di stare meno di 5 minuti in coda per ogni strategia (vedi articolo polacchi per questi ultimi due grafici)}

Al fine di analizzare i risultati sono state introdotte le definizioni di densità e flusso di clienti per ogni step di simulazione; queste misure ci permettono di misurare l'affluenza dei clienti nel supermercato e come questa viene gestita dalle casse che hanno il potere di attivarsi o disattivarsi in base alla quantità di clienti presenti. Densità e flusso permetteranno di disegnare i grafici fondamentali che mostrano per ogni simulazione come le casse smaltiscono l'afflusso di clienti in entrata, soprattutto nei periodi critici (in cui il supermercato raggiunge una quantità di clienti che "mettono alla prova" le casse).

La \textbf{densità} di clienti per step corrisponde al numero di clienti medio per ogni cassa; la densità allo step $i$ è:
\begin{equation}
	\text{density}_i = \frac{\# \text{ customers in the supermarket}}{\# \text{ cashdesks}}
\end{equation}
Si terrà conto della densità totale, della densità per le casse standard o self-service e della densità per le casse self-scan.

Il \textbf{flusso in entrata} di clienti per step corrisponde al numero di clienti che entrano ad ogni step per ogni cassa in media; il flusso allo step $i$ è:
\begin{equation}
	\text{flow}_i = \frac{\# \text{ customers entering in the supermarket}}{\# \text{ cashdesks}}
\end{equation}
Si terrà conto del flusso totale, del flusso per le casse standard o self-service e del flusso per le casse self-scan.

\section{Simulazione con scopo di validazione}

\paragraph{Stato dell'arte}

Al fine di validare il modello, come primo esperimento è stata condotta una simulazione con gli stessi parametri usati nell'articolo \cite{article1}. Nella loro simulazione il supermercato contiene 20 casse standard e 6 casse self-service; si noti che nel lavoro citato, le casse si attivano o disattivano in base ai dati raccolti dai ricercatori nei supermercati, nel nostro modello invece le casse si attivano in base al numero di clienti presenti nel supermercato, in base a un parametro che è possibile cambiare nel momento in cui si raccolgono i dati. Vengono messe a confronto le strategie diverse di scelta della coda da parte dei clienti, arrivando alla conclusione che la strategia che porta al minor tempo d'attesa è quella chiamata "minimo tempo d'attesa in base alla \textit{power regression}" nel capitolo \ref{implementation:intro}; tuttavia i risultati portano a dire che questo scenario non è quello ottimale per tutti i supermercati negli orari di punta.

Nelle prossime simulazioni verrà testato il jockeying, in particolare si metteranno a confronto le diverse strategie di scelta della coda e di jockeying per stabilire se questo porti a un miglioramento dell'esperienza del cliente nel supermercato. Questi esperimenti verranno poi messi a confronto con una simulazione in cui c'è soltanto la coda condivisa per le casse standard, pertanto i clienti non avranno bisogno di scegliere la coda nè di fare jockeying: in base a quanto detto nell'articolo \cite{yanagisawa2011methods}, questo tipo di coda dovrebbe portare a tempi di attesa minori. 
Verranno quindi introdotte nella simulazione le casse self-scan con rilettura randomica, si prevede che queste portino a una diminuzione considerevole dei tempi d'attesa in coda, in quanto viene a mancare la fase di scanner da parte dei cassieri. Infine verrà effettuata una simulazione con gli elementi probabilistici già descritti nel corso dei capitoli \ref{chapter:model} e \ref{implementation:intro}, che rendono l'esperimento non deterministico e a nostro riguardo più realistico.

\paragraph{Simulazione con gli stessi parametri}

Come validazione sono state effettuate delle simulazioni con gli stessi parametri usati nell'articolo \cite{article1}: 20 casse standard con code parallele, 6 casse self-service, no jockeying; è stata ripetuta la stessa simulazione 4 volte però con le 4 strategie diverse di scelta della coda.

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/total_customers_validation.png"}
	\caption{Numero totale di clienti ad ogni ora.}
	\label{fig:total_customers_validation}
\end{figure}

Il grafico \ref{fig:total_customers_validation} funge da validazione: mettiamo a confronto il numero totale di clienti (normalizzati) presenti nel negozio ad ogni ora per ogni simulazione e per la simulazione dell'articolo. Si nota come, a parità di parametri, il nostro modello e il modello di \cite{article1} sopportino allo stesso modo il numero di clienti presenti nel negozio, facendoli defluire in modo paragonabile.

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_validation.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_validation}
\end{figure}


Nell'immagine \ref{fig:avg_wt_validation} si può vedere la variazione del tempo medio di attesa in coda dei clienti nel corso della giornata lavorativa che va dalle 8:00 alle 22:00. Le simulazioni variano per strategia di scelta della coda da parte dei clienti, si nota quindi che, in assenza di jockeying, la strategia 3 risulta quella che durante l'arco della giornata mantiene il tempo medio più basso, anche se a fine giornata tutte e 4 le strategie raggiungono una media paragonabile.

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso

Nelle prossime simulazioni verranno aggiunte delle caratteristiche che pensiamo possano migliorare il tempo medio d'attesa dei clienti, che metteremo a confronto con questa simulazione che rappresenta il punto di partenza.

\section{Simulazione con strategie \textit{jockey}}

Introduciamo dunque le 2 strategie di jockey descritte nel capitolo \ref{implementation:intro}. In queste simulazioni sono presenti 20 casse normali con code parallele, 6 casse self-service, 4 strategie di scelta della coda e 2 strategie di jockeying, per un totale di 8 simulazioni.

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_jockey_a.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_jockey_a}
\end{figure}

Nell'immagine \ref{fig:avg_wt_jockey_a} si mettono a confronto 2 strategie di scelta della coda: minimo numero di elementi, minimo numero di persone in coda. Le due strategie sono affiancate da nessun jockeying, jockey per minimo numero di elementi e jockey per minimo numero di persone in coda. \\ 
Si osserva che i risultati migliori si raggiungono quando la strategia di scelta della coda è la stessa del jockey, con una diminuzione massima del tempo medio di attesa di circa 2 timestamp (1 minuto) e della media finale di 1 timestamp (30 secondi) rispetto alle simulazioni senza jockey. Si può dire pertanto che mischiare le strategie, ad esempio scegliendo la coda per numero di persone e facendo jockey per numero di elementi nei carrelli, peggiori le prestazioni del sistema rispetto al tempo di attesa dei clienti.

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_jockey_b.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_jockey_b}
\end{figure}

Nell'immagine \ref{fig:avg_wt_jockey_b} vengono messe a confronto 2 strategie di scelta della coda: minimo tempo d'attesa in base al tempo di servizio medio, minimo tempo d'attesa in base alla power regression. Le due strategie sono affiancate da nessun jockeying, jockey per minimo numero di elementi e jockey per minimo numero di persone in coda. \\
In questo caso non vale quanto detto sopra, le strategie di scelta della coda e di jockey non possono essere le stesse e non si può dire che affiancandole si ottengono risultati migliori; questo potrebbe rappresentare un ulteriore studio da fare per allargare il nostro modello.

Si nota come la strategia di scelta della coda che mantiene il tempo d'attesa medio minore durante tutta la giornata sia la power regression affiancata da jockey per minimo numero di persone in coda; questa simulazione raggiunge un tempo medio d'attesa minore finale di circa 1.5 timestamp rispetto alla simulazione peggiore. Questa però è comunque molto vicina al tempo medio della strategia di scelta della coda per minimo tempo di servizio medio e senza jockeying, anche se quest'ultima tende a peggiorare nell'ora finale.

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_jockey_best.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_jockey_best}
\end{figure}

Nel grafico \ref{fig:avg_wt_jockey_best} mettiamo a confronto il tempo medio d'attesa delle migliori strategie viste fin ora: il tempo medio finale è circa lo stesso per tutte e tre, ma si nota che il grafico della prima strategia rimane sotto gli altri nell'arco di tutta la giornata.

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso

\section{Simulazione con coda condivisa}

Con le prossime simulazioni indagheremo sulla diminuzione del tempo medio d'attesa nel caso di coda condivisa (N-fork): metteremo a confronto la strategia migliore trovata fin ora (scelta della coda e jockey per minimo numero di elementi) con il caso di una coda condivisa per tutte le casse. \\
Come già specificato, nei casi esaminati fin ora le casse si aprivano e chiudevano in maniera automatica in base al numero di clienti presenti nel negozio e che necessitano di essere serviti; nel caso di coda condivisa questa funzione non è stata implementata, e potrebbe rappresentare un'estensione del nostro modello. Per questo motivo abbiamo deciso di diminuire il numero di casse nella simulazione: in base a osservazioni fatte in fase sperimentale abbiamo notato che il numero di casse aperte massimo in un dato momento è 8, chiaramente rispetto alla distribuzione dei clienti in entrata utilizzata; per questo motivo abbiamo voluto indagare i casi di 5, 6, 7 e 8 casse standard presenti nel negozio (e 6 casse self-service come fatto in precedenza).

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_codacondivisa.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_codacondivisa}
\end{figure}

Nel grafico \ref{fig:avg_wt_codacondivisa} riportiamo i tempi medi d'attesa delle simulazioni con code parallele e jockey rappresentandoli con delle linee, e i tempi medi d'attesa delle simulazioni con coda condivisa rappresentandoli con dei trattini. Si nota immediatamente che nel caso di 5 casse il tempo medio d'attesa sale vertiginosamente a circa 30 minuti sia per le code parallele che per la coda condivisa: questo è imputabile alla distribuzione dei clienti in entrata, il supermercato con 5 casse è troppo piccolo per gestire questa quantità. \\
Una cosa interessante da notare invece è la divisione netta nel grafico tra le simulazioni con code parallele e quelle con coda condivisa: l'utilizzo della coda condivisa abbassa i tempi medi d'attesa durante tutta la giornata, anche rispetto al caso in cui i clienti fanno jockey. CITARE ARTICOLO CHE LO DICEVA

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso

\section{Simulazione con casse self-scan}

In questa simulazione vedremo il caso in cui nel supermercato sono presenti solamente casse self-scan, in particolare 7; in questa simulazione chiaramente tutti i clienti si recheranno alla cassa self-scan, la probabilità di una rilettura parziale è del $2\%$ e una rilettura totale è dell'$1\%$.

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_selfscan.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_selfscan}
\end{figure}

Si nota immediatamente dal grafico \ref{fig:avg_wt_selfscan} che il tempo medio d'attesa della simulazione con self-scan va ad aumentare sempre più; questo accade a causa delle riletture, infatti i clienti che non ricevono una rilettura escono immediatamente dal negozio, mentre gli altri restano in coda ad una sola cassa, che funge da collo di bottiglia. Aumentando la probabilità di rilettura, infatti, la simulazione fallisce perchè la coda alla cassa riservata diventa troppo lunga. \\
Rispetto a questa simulazione bisognerebbe avere dati più completi, ad esempio sapere con che probabilità vengono fatte le riletture nei supermercati o con che distribuzione entrano in negozio i clienti self-scan; questo è una possibile estensione del nostro lavoro.

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso

\section{Simulazione non deterministica}

L'introduzione di parametri randomici rappresenta la nostra volontà di rendere più verosimile il modello e non un tentativo di miglioramento dei tempi medi d'attesa dei clienti. \\
Abbiamo voluto testare il modello completo, considerando 20 casse standard con code parallele, 6 casse self-service, 5 casse self-scan; la probabilità che un cliente sia self-scan (nel momento in cui entra nel negozio) è del $50\%$. Introduciamo anche l'errore di stima del basket-size da parte di un cliente: nel momento in cui un cliente deve calcolare il numero di elementi nel carrello di altri clienti commette un errore con 0.1 di deviazione standard. \\
Le simulazioni sono 8, combiniamo le strategie di scelta della coda (4) con quelle di jockey (2).

\begin{figure}[htp!]
	\centering
	\includegraphics[width=12cm]{"images/results/avg_wt_prob.png"}
	\caption{Tempo medio d'attesa in coda ad ogni ora.}
	\label{fig:avg_wt_prob}
\end{figure}

Notiamo dal grafico \ref{fig:avg_wt_prob} che il tempo medio d'attesa delle simulazioni con e senza elementi randomici (raggruppati a coppie per colore, una tratteggiata e una no) è assolutamente paragonabile e questo ci mostra che gli elementi che abbiamo aggiunto, giustificati dal buon senso, non scombinano totalmente il modello ma lo rendono semplicemente più imprevedibile, riuscendo a simulare più scenari possibili.

\todo{aggiungere grafico fondamentale e altri grafici}

osservazioni su quanto le varie strategie reggono il flusso


\vspace*{1\baselineskip}


\todo{In questo capitolo dove necessario citare xu1996dynamic che dice
  che a parità di parametri un sistema con jockeying è più efficente
  che uno senza}

Abbiamo visto che ... nel prossimo capitolo tiriamo le conclusioni.
